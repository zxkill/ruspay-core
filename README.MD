# RusPay Core โ openโsource selfโhost payment gateway for Russian acquirers

> **Keywords**: open source ะฟะปะฐัะตะถะฝัะน ัะปัะท, unified API YooKassa Tinkoff Pay SberPay, selfโhost Stripe ะฐะฝะฐะปะพะณ, Docker ัะบะฒะฐะนัะธะฝะณ, Laravel payment microservice, Omnipay bridge

**RusPay Core** โ ััะพ ะฑะตัะฟะปะฐัะฝัะน MITโะฟัะพะตะบั, ะบะพัะพััะน ะพะฑัะตะดะธะฝัะตั YooKassa, Tinkoff Pay ะธ SberPay ะฟะพะด ะตะดะธะฝัะผ REST. ะั ัะฐะทะฒะพัะฐัะธะฒะฐะตัะต ัะปัะท ั ัะตะฑั ะฝะฐ ัะตัะฒะตัะต (`dockerโcompose up`) ะธ ะฟะพะดะบะปััะฐะตัะต ะธะฝัะตัะฝะตัโะผะฐะณะฐะทะธะฝ ะธะปะธ SaaSโัะตัะฒะธั ัะฐะบ ะถะต ะฟัะพััะพ, ะบะฐะบ Stripe, ะฝะพ ะฑะตะท ัะฐะฝะบัะธะพะฝะฝัั ัะธัะบะพะฒ.

![CI](https://github.com/zxkill/ruspay-core/actions/workflows/ci.yml/badge.svg)

---

## ๐ ะะพัะตะผั ััะพ ะฒะฐะถะฝะพ

* SaaSโะบะพะผะฟะฐะฝะธัะผ ะฒ ะะค ะฟัะธัะพะดะธััั ะพะดะฝะพะฒัะตะผะตะฝะฝะพ ัะฐะฑะพัะฐัั ั 3โ4 ะฑะฐะฝะบะฐะผะธ โ ะบะฐะถะดัะน ัะพ ัะฒะพะธะผ SDK, ะฟะพะดะฟะธััะผะธ ะธ ััะฐัััะฐะผะธ.
* ะะต ัััะตััะฒะพะฒะฐะปะพ selfโhost openโsource ะฐะณัะตะณะฐัะพัะฐ ยซะธะท ะบะพัะพะฑะบะธยป ะดะปั ะปะพะบะฐะปัะฝัั ัะบะฒะฐะนัะธะฝะณะพะฒ.
* **RusPay Core** ะทะฐะบััะฒะฐะตั ะฟัะพะฑะตะป: ะตะดะธะฝัะน API + ะฟะปะฐะณะธะฝะฝะฐั ะฐััะธัะตะบัััะฐ + GUI + ัะตััะพะฒัะน ััะตะฝะด.

---

## โจ ะะปััะตะฒัะต ัะธัะธ (MVP v0.1)

| โ๏ธ | ะะพะทะผะพะถะฝะพััั                                                                |
| - |----------------------------------------------------------------------------|
| โ | `POST /payments` ัะพะทะดะฐัั ะฟะปะฐััะถ ะธ ะพัะดะฐัั `checkout_url` (YooKassa sandbox) |
| โ | ะขะฐะฑะปะธัะฐ **payments** ะฒ PostgreSQL (UUID PK, enumโััะฐััั, JSON payload)     |
| โ | Dockerโััะตะบ: nginx + phpโfpm 8.4 + Postgres 15 โ ััะฐัั ะทะฐ 1 ะผะธะฝััั         |
| โ | Healthโัะพัั `/health/db` ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ                                   |
| โ | GitHub Actions: composer > migrate > PHPUnit โ ยซbuild โ๏ธยป badge            |
| โ๏ธ | ะะปะฐะณะธะฝโัะปะพะน Omnipay โ ะดัะฐะนะฒะตัั Tinkoff Pay / Sber Pay ะณะพัะพะฒั ะบ ะฟะพะดะบะปััะตะฝะธั |

---

## ๐ QuickโStart (< 10 ะผะธะฝ)

```bash
# 1. ะบะปะพะฝ ะธ ะฟะตัะตะผะตะฝะฝัะต
$ git clone https://github.com/zxkill/ruspay-core.git
$ cd ruspay-core
$ cp .env.example .env   # ัะบะฐะถะธัะต YOO_SHOP_ID / YOO_SECRET

# 2. ะทะฐะฟััะบะฐะตะผ ะฒะตัั ััะตะบ
$ docker compose up --build
```

ะัะพะฒะตัััะต:

```bash
# ะทะดะพัะพะฒัะต ะะ
$ curl http://localhost:8080/health/db
{"db":"ok"}

# ะฟะปะฐััะถ 100 โฝ
$ curl -X POST http://localhost:8080/api/v1/payments \
       -H "Content-Type: application/json" \
       -d '{"amount":100}'
{"payment_id":"โฆuuidโฆ","checkout_url":"https://checkout.test.yookassa.ru/โฆ"}
```

---

## โ๏ธ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

| ะกะปะพะน         | ะขะตัะฝะพะปะพะณะธั                               |
| ------------ | ---------------------------------------- |
| Framework    | **Laravel 11** (REST / GraphQL)          |
| Payments SDK | Omnipay 3 + YooKassa driver              |
| Database     | PostgreSQL 15                            |
| Runtime      | php:8.4โfpm (pdo, pgsql, opcache)        |
| Proxy        | nginx\:alpine                            |
| CI           | GitHub Actions (lint, PHPUnit, coverage) |

---

## ๐๏ธ ะะฐะทะฐ ะดะฐะฝะฝัั (ััะตะผะฐ v0.1)

* `payments` โ id UUID, provider, amount, currency, status (pending | succeeded | failed | canceled), raw\_payload JSON.
* `refunds`, `api_tokens` โ ะฟะพะดะณะพัะพะฒะปะตะฝั ะผะธะณัะฐัะธะธ ะดะปั ัะฟัะธะฝัะฐ 2.

---

## ๐งช ะขะตััั ะธ ะบะฐัะตััะฒะพ ะบะพะดะฐ

* **PHPUnit** โ ัะตะนะบะพะฒัะน YooKassaโะบะปะธะตะฝั ะพะฑะตัะฟะตัะธะฒะฐะตั ะดะตัะตัะผะธะฝะธัะพะฒะฐะฝะฝัะต ัะตััั.
* ะะพะบัััะธะต ะฑะฐะทะพะฒัั ััะตะฝะฐัะธะตะฒ (create + webhook) > 70 % โ ะฟะปะฐะฝะธััะตััั ะบ ะบะพะฝัั ัะฟัะธะฝัะฐ 2.
* PSRโ12 + PHPโCSโFixer โ ะฟัะพะฒะตััะตััั ะฒ CI.

---

## ๐ฃ๏ธ Roadmap

| ะกะฟัะธะฝั | ะฆะตะปั                                                            |
| ------ |-----------------------------------------------------------------|
| 2      | ะฟัะพะฒะฐะนะดะตัั **Tinkoff Pay** + **SberPay**, ะฒะตะฑโััะบะธ, ะตะดะธะฝัะน enum |
| 3      | AdminJS GUI, tokenโauth, manual refund                          |
| 4      | Demo checkout, Swagger / GraphQL, CI coverage โฅ 70 %            |

---

## ๐ค ะะฐะบ ะฟะพะผะพัั

* ะกะดะตะปะฐัั Omnipayโะฐะดะฐะฟัะตั **QIWI** / **CloudPayments**.
* ะฃะปัััะธัั Admin Dashboard: ัะธะปัััั, ัะบัะฟะพัั CSV.
* ะะตัะตะฒะตััะธ ะดะพะบัะผะตะฝัะฐัะธั ะฝะฐ ะฐะฝะณะปะธะนัะบะธะน / ะธัะฟะฐะฝัะบะธะน.
* ะะฐะฟะธัะฐัั ะธะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั edgeโcases (duplicate webhook, partial refund).

---

## โ๏ธ ะะธัะตะฝะทะธั

MIT โ ะธัะฟะพะปัะทัะนัะต ัะฒะพะฑะพะดะฝะพ ะฒ ะบะพะผะผะตััะตัะบะธั ะธ openโsource ะฟัะพะตะบัะฐั.

> **RusPay Core** โ ะตะดะธะฝัะน selfโhost ัะปัะท ะดะปั YooKassa, Tinkoff ะธ ะกะฑะตั.
> ะะฐะทะฒะพัะฐัะธะฒะฐะตััั ะทะฐ 1 ะบะปะธะบ, ัะฐััะธััะตััั ะดัะฐะนะฒะตัะฐะผะธ, ะฟะพะบััั ัะตััะฐะผะธ ะธ ะฝะต ะทะฐะฒะธัะธั ะพั ะทะฐััะฑะตะถะฝัั ะฟะปะฐััะถะฝัั ัะตัะฒะธัะพะฒ.
